document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("loginForm");if(m){const l=document.getElementById("emailInput"),g=document.getElementById("passwordInput"),w=document.getElementById("roleInput");document.querySelectorAll(".role-tab").forEach(o=>{o.addEventListener("click",()=>{document.querySelectorAll(".role-tab").forEach(d=>d.classList.remove("active")),o.classList.add("active"),w.value=o.dataset.role})}),m.addEventListener("submit",o=>{let d=!1;const a=l.value.trim();/@diu\.edu\.bd$/i.test(a)?(document.getElementById("emailError")?.classList.add("hidden"),l.classList.remove("ring-2","ring-red-400")):(d=!0,document.getElementById("emailError")?.classList.remove("hidden"),l.classList.add("ring-2","ring-red-400")),g.value?document.getElementById("passwordError")?.classList.add("hidden"):(d=!0,document.getElementById("passwordError")?.classList.remove("hidden")),d&&o.preventDefault()})}const f=document.getElementById("registrationForm");if(f){const l=document.getElementById("email"),g=document.getElementById("password"),w=document.getElementById("password_confirmation"),o=document.getElementById("selectedRole"),d=document.querySelectorAll(".role-card"),a=document.getElementById("idField"),c=document.getElementById("idLabel");d.forEach(r=>{r.addEventListener("click",()=>{d.forEach(n=>n.classList.remove("selected")),r.classList.add("selected"),o.value=r.dataset.role,a.classList.remove("hidden"),c.textContent=r.dataset.role==="student"?"Student ID":"Employee ID"})}),f.addEventListener("submit",r=>{let n=!1;o.value?document.getElementById("roleError")?.classList.add("hidden"):(n=!0,document.getElementById("roleError")?.classList.remove("hidden")),/@diu\.edu\.bd$/i.test(l.value.trim())?l.classList.remove("ring-2","ring-red-400"):(n=!0,l.classList.add("ring-2","ring-red-400")),g.value.length<8&&(n=!0,showError("Password must be at least 8 characters.")),g.value!==w.value&&(n=!0,showError("Password confirmation does not match."));const i=document.getElementById("userId");o.value&&!i.value.trim()?(n=!0,i.classList.add("ring-2","ring-red-400")):i?.classList.remove("ring-2","ring-red-400"),n&&r.preventDefault()})}});document.addEventListener("DOMContentLoaded",function(){const m=document.getElementById("loginForm")!==null,f=document.getElementById("registrationForm")!==null;if(m){let E=function(){const s=a.value.trim(),u=c.value.trim();return s?s.includes("@diu.edu.bd")?u?u.length<6?(showError("Password must be at least 6 characters long"),!1):!0:(showError("Please enter your password"),!1):(showError("Please use your @diu.edu.bd email address"),!1):(showError("Please enter your email"),!1)};var g=E;const o=document.querySelectorAll(".role-tab"),d=document.getElementById("loginForm"),a=document.getElementById("emailInput"),c=document.getElementById("passwordInput"),r=document.getElementById("loginButton"),n=document.getElementById("roleInput");let i="student";o.forEach(s=>{s.addEventListener("click",function(){o.forEach(u=>{u.classList.remove("active")}),this.classList.add("active"),i=this.getAttribute("data-role"),n.value=i})}),d.addEventListener("submit",function(s){if(s.preventDefault(),!E())return;r.disabled=!0,r.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Signing In...';const u=document.createElement("input");u.type="hidden",u.name="role",u.value=i;const I=this.querySelector('input[name="role"]');I&&I!==document.getElementById("roleInput")&&I.remove();const y=document.getElementById("roleInput");y?y.value=i:this.appendChild(u),this.submit()}),[a,c].forEach(s=>{s.addEventListener("focus",function(){this.parentElement.classList.add("ring-2","ring-white/30")}),s.addEventListener("blur",function(){this.parentElement.classList.remove("ring-2","ring-white/30")})});const v=document.getElementById("googleLogin"),B=document.getElementById("githubLogin");v&&v.addEventListener("click",function(s){s.preventDefault(),window.location.href=`/auth/google?role=${i}`}),B&&B.addEventListener("click",function(s){s.preventDefault(),window.location.href=`/auth/github?role=${i}`}),document.getElementById("forgotPasswordLink")?.addEventListener("click",function(s){s.preventDefault(),showInfo("Forgot password functionality will be implemented soon!")});const h=document.getElementById("registerLink");h&&h.addEventListener("click",function(s){s.preventDefault(),window.location.href="/register"})}if(f){let b=function(){let e=!0;const t=[];a.value||(y.classList.remove("hidden"),e=!1,t.push("Please select a role")),document.getElementById("email").value.endsWith("@diu.edu.bd")||(e=!1,t.push("Please use your @diu.edu.bd email address"));const p=v.value,P=B.value;p.length<8&&(e=!1,t.push("Password must be at least 8 characters long")),p!==P&&(e=!1,t.push("Passwords do not match"));const q=/[A-Z]/.test(p),x=/[a-z]/.test(p),C=/\d/.test(p),D=/\W/.test(p);return q&&x&&C&&D||(e=!1,t.push("Password must contain uppercase, lowercase, numbers, and special characters")),e||l(t.join("<br>")),e};var w=b;const o=document.getElementById("registrationForm"),d=document.querySelectorAll(".role-card"),a=document.getElementById("selectedRole"),c=document.getElementById("idField"),r=document.getElementById("idLabel"),n=document.getElementById("userId"),i=document.getElementById("student_id"),E=document.getElementById("employee_id"),v=document.getElementById("password"),B=document.getElementById("password_confirmation"),h=document.getElementById("togglePassword"),s=document.getElementById("submitBtn"),u=document.getElementById("submitText"),I=document.getElementById("submitLoader"),y=document.getElementById("roleError");d.forEach(e=>{e.addEventListener("click",function(){d.forEach(L=>L.classList.remove("selected")),this.classList.add("selected");const t=this.getAttribute("data-role");a.value=t,t&&(c.classList.remove("hidden"),t==="student"?(r.textContent="Student ID",n.placeholder="221-15-4716",n.setAttribute("required","required")):t==="instructor"&&(r.textContent="Employee ID",n.placeholder="EMP001",n.setAttribute("required","required")),y.classList.add("hidden"))})}),h&&h.addEventListener("click",function(){const e=v.getAttribute("type")==="password"?"text":"password";v.setAttribute("type",e);const t=this.querySelector("i");e==="text"?(t.classList.remove("fa-eye"),t.classList.add("fa-eye-slash")):(t.classList.remove("fa-eye-slash"),t.classList.add("fa-eye"))}),n&&n.addEventListener("input",function(){const e=a.value,t=this.value;e==="student"?(i.value=t,E.value=""):e==="instructor"&&(E.value=t,i.value="")}),o&&o.addEventListener("submit",function(e){if(!b()){e.preventDefault();return}s.disabled=!0,u.textContent="Creating Account...",I.classList.remove("hidden");const t=a.value,L=n.value;t==="student"?(i.value=L,E.value=""):t==="instructor"&&(E.value=L,i.value="")});const A=a.value;if(A){const e=document.querySelector(`[data-role="${A}"]`);e&&e.click()}document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]').forEach(e=>{e.addEventListener("focus",function(){this.classList.add("ring-2","ring-white/30")}),e.addEventListener("blur",function(){this.classList.remove("ring-2","ring-white/30")})})}function l(o,d){document.querySelectorAll(".dynamic-message").forEach(n=>n.remove());const c=document.createElement("div");c.className="dynamic-message mb-6 p-4 rounded-lg border bg-red-50 border-red-200 text-red-800",c.innerHTML=`
            <div class="flex">
                <i class="fas fa-exclamation-circle text-red-500 mr-3 mt-0.5"></i>
                <div>
                    <h3 class="font-semibold">Registration Failed</h3>
                    <div class="mt-2 text-sm">${o}</div>
                </div>
            </div>
        `;const r=document.querySelector(".glass-effect");r&&r.insertBefore(c,r.firstChild),setTimeout(()=>{c.remove()},1e4)}});window.authPageFunctions={showError:function(m){console.error("Auth Error:",m)},showMessage:function(m,f){console.log(`Auth ${f}:`,m)}};window.loginWithGoogle=function(m){document.querySelectorAll('button[onclick*="loginWithGoogle"]').forEach(l=>{l.disabled=!0,l.classList.add("opacity-50","cursor-not-allowed");const g=l.querySelector("span");g&&(g.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Redirecting...')}),window.location.href=`/auth/google/${m}`};
