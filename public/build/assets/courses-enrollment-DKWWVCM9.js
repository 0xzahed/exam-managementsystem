document.addEventListener("DOMContentLoaded",function(){m()});let r=null;function m(){f()}function f(){document.addEventListener("keydown",function(e){e.key==="Escape"&&s()});const t=document.getElementById("enrollModal");t&&t.addEventListener("click",function(e){e.target===this&&s()})}function w(t){r=t;const o=document.querySelector(`[onclick*="enrollCourse('${t}')"]`)?.closest(".course-card")?.querySelector("h3")?.textContent?.trim()||"this course",a=document.getElementById("enrollMessage"),i=document.getElementById("passwordSection"),l=document.getElementById("enrollModal");a&&(a.textContent=`Are you sure you want to enroll in ${o}?`),i&&i.classList.remove("hidden"),l&&(l.classList.remove("hidden"),l.classList.add("flex"));const d=document.getElementById("coursePassword");d&&(d.value="",d.focus()),c()}function E(){if(!r){showError("Course not selected. Please try again.");return}const t=document.getElementById("coursePassword"),e=t?.value.trim();if(!e){u("Please enter the course password."),t?.focus();return}c(),n(!0),p(e)}function p(t){const e=new FormData;e.append("password",t),e.append("_token",document.querySelector('meta[name="csrf-token"]').getAttribute("content")),fetch(`/student/courses/${r}/enroll`,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(o=>o.json()).then(o=>{n(!1),o.success?(s(),showSuccess(o.message)):o.message&&o.message.toLowerCase().includes("password")?u(o.message):showError(o.message||"Enrollment failed. Please try again.")}).catch(o=>{console.error("Enrollment error:",o),n(!1),showError("Network error. Please check your connection and try again.")})}function u(t){const e=document.getElementById("coursePassword");let o=document.getElementById("passwordError");o||(o=document.createElement("p"),o.id="passwordError",o.className="text-red-600 text-sm mt-2",e?.parentNode?.appendChild(o)),e&&e.classList.add("border-red-500"),o&&(o.textContent=t,o.style.display="block")}function c(){const t=document.getElementById("coursePassword"),e=document.getElementById("passwordError");t&&t.classList.remove("border-red-500"),e&&(e.style.display="none")}function n(t){const e=document.querySelector('#enrollModal button[onclick="confirmEnrollment()"]'),o=document.getElementById("coursePassword");t?(e&&(e.disabled=!0,e.textContent="Enrolling..."),o&&(o.disabled=!0)):(e&&(e.disabled=!1,e.textContent="Confirm"),o&&(o.disabled=!1))}function s(){const t=document.getElementById("enrollModal");t&&(t.classList.add("hidden"),t.classList.remove("flex"));const e=document.getElementById("coursePassword");e&&(e.value=""),c(),n(!1),r=null}function y(){window.location.href="/my-courses"}function g(){["courseModal","enrollModal","successModal"].forEach(e=>{const o=document.getElementById(e);o&&(o.classList.add("hidden"),o.classList.remove("flex"))})}window.enrollCourse=w;window.confirmEnrollment=E;window.closeEnrollModal=s;window.redirectToMyCourses=y;window.closeModal=g;console.log("Enrollment UI loaded");
