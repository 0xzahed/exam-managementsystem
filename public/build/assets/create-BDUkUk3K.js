document.addEventListener("DOMContentLoaded",function(){f(),y(),p(),D()});function f(){console.log("Assignment form initialized"),g();const t=document.getElementById("submissionType");t&&t.addEventListener("change",v);const e=document.getElementById("courseId");e&&e.addEventListener("change",E)}function g(){const t=document.getElementById("assignDate"),e=document.getElementById("dueDate");if(t&&!t.value){const n=new Date;t.value=c(n)}if(e&&!e.value){const n=new Date;n.setDate(n.getDate()+7),e.value=c(n)}}function c(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${e}-${n}-${s}T${o}:${d}`}function y(){const t=document.getElementById("assignmentForm");t&&t.addEventListener("submit",function(e){l()||(e.preventDefault(),showError("Please fill in all required fields correctly."))})}function p(){const t=document.getElementById("assignDate"),e=document.getElementById("dueDate");t&&e&&(t.addEventListener("change",m),e.addEventListener("change",m))}function m(){const t=document.getElementById("assignDate"),e=document.getElementById("dueDate");if(t.value&&e.value){const n=new Date(t.value);new Date(e.value)<=n?(showError("Due date must be after assign date."),e.setCustomValidity("Due date must be after assign date")):(e.setCustomValidity(""),u())}}function v(){const t=document.getElementById("submissionType"),e=t.closest(".space-y-4").querySelector("[data-file-types]");t.value==="text"?e&&(e.style.display="none"):e&&(e.style.display="block")}function E(){const t=document.getElementById("courseId");console.log("Selected course:",t.value)}function D(){const t=document.getElementById("instructorFiles");t&&t.addEventListener("change",function(e){b(e.target.files)})}function b(t){const n=[".pdf",".docx"];for(let s of t){if(s.size>10485760)return showError(`File "${s.name}" is too large. Maximum size is 10MB.`),!1;const o="."+s.name.split(".").pop().toLowerCase();if(!n.includes(o))return showError(`File type "${o}" is not allowed for "${s.name}". Only PDF and DOCX files are allowed.`),!1}return u(),!0}function l(){const t=["courseId","assignmentTitle","assignDate","dueDate","marks"];let e=!0;for(let i of t){const a=document.getElementById(i);a&&!a.value.trim()?(a.classList.add("border-red-500"),e=!1):a&&a.classList.remove("border-red-500")}if(typeof tinymce<"u"){const i=tinymce.get("instructions");i&&(i.getContent({format:"text"}).trim()||(showError("Assignment instructions are required."),e=!1))}else{const i=document.getElementById("instructions");i&&!i.value.trim()&&(i.classList.add("border-red-500"),e=!1)}const n=document.getElementById("assignDate"),s=document.getElementById("dueDate");if(n.value&&s.value){const i=new Date(n.value);new Date(s.value)<=i&&(e=!1)}const o=document.getElementById("marks");o&&(o.value<1||o.value>100)&&(o.classList.add("border-red-500"),e=!1);const d=document.getElementById("maxAttempts");return d&&(d.value<1||d.value>5)&&(d.classList.add("border-red-500"),e=!1),e}function h(){console.log("Saving draft...");const t=document.getElementById("assignmentStatus");if(t&&(t.value="draft"),typeof tinymce<"u"){const e=tinymce.get("instructions");e&&e.save()}l()?(r("Saving draft..."),document.getElementById("assignmentForm").submit()):showError("Please fill in all required fields before saving.")}function w(){console.log("Publishing assignment...");const t=document.getElementById("assignmentStatus");if(t&&(t.value="published"),typeof tinymce<"u"){const e=tinymce.get("instructions");e&&e.save()}l()?confirm("Are you sure you want to publish this assignment? Students will be notified immediately.")&&(r("Publishing assignment..."),document.getElementById("assignmentForm").submit()):showError("Please fill in all required fields before publishing.")}function I(){console.log("Updating assignment...");const t=document.getElementById("assignmentStatus");if(t&&(t.value="published"),typeof tinymce<"u"){const e=tinymce.get("instructions");e&&e.save()}l()?confirm("Are you sure you want to update this assignment?")&&(r("Updating assignment..."),document.getElementById("assignmentForm").submit()):showError("Please fill in all required fields before updating.")}function u(){const t=document.getElementById("error-message");t&&t.remove()}function r(t){u();const e=document.createElement("div");e.className="fixed top-4 right-4 bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded z-50",e.innerHTML=`
        <div class="flex items-center">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-700 mr-2"></div>
            <span>${t}</span>
        </div>
    `,e.id="loading-message",document.body.appendChild(e)}window.saveDraft=h;window.publishAssignment=w;window.updateAssignment=I;window.hideError=u;
