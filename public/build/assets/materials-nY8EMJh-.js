console.log("Materials.js loading...");window.showModal=function(e){console.log("showModal called with:",e);const o=document.getElementById(e);o?(o.classList.remove("hidden"),o.classList.add("flex"),console.log("Modal shown:",e)):console.error("Modal not found:",e)};window.hideModal=function(e){console.log("hideModal called with:",e);const o=document.getElementById(e);o&&(o.classList.add("hidden"),o.classList.remove("flex"),console.log("Modal hidden:",e))};window.closeMaterialModal=function(){hideModal("materialModal"),clearFileSelection()};window.closeSectionModal=function(){hideModal("sectionModal")};window.closeEditMaterialModal=function(){hideModal("editMaterialModal")};window.toggleMaterialFields=function(){const e=document.getElementById("materialType");if(!e)return;const o=e.value,t=document.getElementById("fileField"),n=document.getElementById("textField");t&&(t.style.display="none"),n&&(n.style.display="none"),o==="file"&&t?t.style.display="block":o==="text"&&n&&(n.style.display="block")};window.clearFileSelection=function(){console.log("Clearing file selection");const e=document.getElementById("materialFile"),o=document.getElementById("fileUploadArea"),t=o?.querySelector(".upload-content"),n=o?.querySelector(".file-selected");e&&(e.value="",console.log("File input cleared")),t&&(t.style.display="block",t.classList.remove("hidden"),console.log("Upload content shown")),n&&(n.style.display="none",n.classList.add("hidden"),console.log("File selected area hidden")),o&&(o.classList.remove("border-green-400","bg-green-50"),o.classList.add("border-gray-300"),console.log("Upload area reset to default style"))};window.toggleSection=function(e){const o=document.querySelector(`[data-section="${e}"]`);if(o){const t=o.querySelector(".section-content"),n=o.querySelector(".section-toggle");t.style.maxHeight==="0px"||!t.style.maxHeight?(t.style.maxHeight=t.scrollHeight+"px",n.style.transform="rotate(180deg)"):(t.style.maxHeight="0px",n.style.transform="rotate(0deg)")}};window.editSection=function(e){console.log("Edit section:",e)};window.scrollToSection=function(e){const o=document.getElementById(e);o&&o.scrollIntoView({behavior:"smooth"})};window.editMaterial=function(e){showModal("editMaterialModal");const o=document.getElementById("editMaterialId");o&&(o.value=e),showInfo("Loading material data..."),fetch(`/courses/${d()}/materials/${e}/edit`).then(t=>t.json()).then(t=>{t.material?u(t.material):showError("Material data not found")}).catch(t=>{console.error("Error fetching material data:",t),showError("Failed to load material data")})};function u(e){document.getElementById("editMaterialId").value=e.id,document.getElementById("editMaterialTitle").value=e.title,document.getElementById("editMaterialDescription").value=e.description,document.getElementById("editMaterialSection").value=e.section,e.is_private?document.getElementById("editPrivate").checked=!0:document.getElementById("editPublic").checked=!0;const o=document.getElementById("editContentContainer");o.innerHTML="",e.type==="text"?o.innerHTML=`
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                <textarea name="content" rows="6" placeholder="Enter your text content here..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">${e.content||""}</textarea>
            </div>
        `:e.type==="file"&&(o.innerHTML=`
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Current File</label>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">${e.file_name||"No file"}</p>
                    <p class="text-xs text-gray-500">${e.file_size?(e.file_size/1024).toFixed(1)+" KB":""}</p>
                </div>
                <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">Upload New File (Optional)</label>
                <input type="file" name="file" accept=".pdf,.ppt,.pptx,.doc,.docx,.jpg,.jpeg,.png,.gif" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
            </div>
        `);const t=document.getElementById("editMaterialForm");t.action=`/courses/${d()}/materials/${e.id}`,t.method="POST";const n=document.createElement("input");n.type="hidden",n.name="_method",n.value="PUT",t.appendChild(n);const l=document.createElement("input");l.type="hidden",l.name="_token",l.value=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t.appendChild(l)}function d(){const e=document.getElementById("courseViewRoot");return e?e.getAttribute("data-course-id"):null}window.toggleMaterialPrivacy=function(e,o){console.log("Toggle privacy for material:",e,"isPrivate:",o);const t=d();if(!t){showError("Course ID not found");return}const n=`/courses/${t}/materials/${e}/privacy`,l=!o;fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({is_private:l})}).then(i=>i.json()).then(i=>{i.success?(showSuccess(i.message||"Privacy setting updated successfully"),setTimeout(()=>{location.reload()},1e3)):showError(i.message||"Failed to update privacy setting")}).catch(i=>{console.error("Error:",i),showError("An error occurred while updating privacy setting")})};document.addEventListener("DOMContentLoaded",function(){console.log("Materials.js initialized - DOM ready"),g(),m(),console.log("All functions initialized")});function g(){const e=document.getElementById("fileUploadArea"),o=document.getElementById("materialFile");if(!e||!o){console.warn("File upload elements not found");return}console.log("Setting up file upload"),o.addEventListener("change",function(t){console.log("File input change event fired");const n=t.target.files[0];n&&(console.log("File selected:",n.name),r(n))}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("border-indigo-500","bg-indigo-50"),console.log("File dragged over upload area")}),e.addEventListener("dragleave",t=>{t.preventDefault(),e.contains(t.relatedTarget)||(e.classList.remove("border-indigo-500","bg-indigo-50"),e.classList.add("border-gray-300"))}),e.addEventListener("drop",t=>{t.preventDefault(),console.log("File dropped in upload area");const n=t.dataTransfer.files;if(n.length>0){o.files=n;const l=n[0];l&&r(l)}})}function m(){const e=document.getElementById("materialType");e&&(e.addEventListener("change",toggleMaterialFields),toggleMaterialFields())}function r(e){console.log("showSelectedFile called with:",e.name);const o=10*1024*1024;if(e.size>o){showError("File size exceeds 10MB limit. Please choose a smaller file."),clearFileSelection();return}if(!["application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/jpg","image/png","image/gif"].includes(e.type)){showError("Invalid file type. Please upload PDF, PPT, DOC, or image files only."),clearFileSelection();return}const n=document.getElementById("fileUploadArea"),l=n?.querySelector(".upload-content"),i=n?.querySelector(".file-selected"),s=document.getElementById("selectedFileName"),a=document.getElementById("selectedFileSize");if(s&&(s.textContent=e.name,console.log("Set fileName to:",e.name)),a){const c=(e.size/1024/1024).toFixed(2);a.textContent=`Size: ${c} MB`,console.log("Set fileSize to:",`Size: ${c} MB`)}l&&(l.style.display="none",console.log("Hidden upload content")),i&&(i.style.display="block",i.classList.remove("hidden"),console.log("Showing file selected area")),n&&(n.classList.remove("border-gray-300","hover:border-indigo-500","hover:bg-indigo-50"),n.classList.add("border-green-400","bg-green-50"),console.log("Applied green visual feedback")),console.log("File selection display completed!")}console.log("Materials.js loaded successfully");
